<template>
    <div class="page" data-name="address">
        <div class="navbar">
          <div class="navbar-inner sliding">
            <div class="left">
              <a href="#" class="link back">
                <i class="icon icon-back"></i>
                <span class="ios-only">Back</span>
              </a>
            </div>
            <div class="title">Tambah Alamat</div>
          </div>
        </div>
        <div class="page-content">
            <div class="block">
            <form class="address form-ajax-submit">
              <div class="list no-hairlines-md">
                <ul>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Nama Penerima</div>
                      <div class="item-input-wrap">
                        <input type="text" id="name" name="name" placeholder="Nama Penerima" value="{{name}}" />
                      </div>
                    </div>
                  </li>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Alamat</div>
                      <div class="item-input-wrap">
                        <input type="text" id="address" name="address" placeholder="Alamat" value="{{address}}" />
                      </div>
                    </div>
                  </li>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Nomor Handphone</div>
                      <div class="item-input-wrap">
                        <input type="text" id="phone" name="phone" placeholder="Nomor Handphone" value="{{phone}}" />
                      </div>
                    </div>
                  </li>
                  <!-- <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Email</div>
                      <div class="item-input-wrap">
                        <input type="text" id="email" name="email" placeholder="Email" value="{{email}}" />
                      </div>
                    </div>
                  </li> -->
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Provinsi</div>
                      <div class="item-input-wrap">
                        <select id="province" name="province">
                          <option value=""{{#unless province}} selected{{/unless}}>-</option>
                          <option value="1"{{#js_if "this.province == 1"}} selected{{/js_if}}>BALI</option>
                          <option value="2"{{#js_if "this.province == 2"}} selected{{/js_if}}>BANGKA BELITUNG</option>
                          <option value="3"{{#js_if "this.province == 3"}} selected{{/js_if}}>BANTEN</option>
                          <option value="4"{{#js_if "this.province == 4"}} selected{{/js_if}}>BENGKULU</option>
                          <option value="5"{{#js_if "this.province == 5"}} selected{{/js_if}}>DI YOGYAKARTA</option>
                          <option value="6"{{#js_if "this.province == 6"}} selected{{/js_if}}>DKI JAKARTA</option>
                          <option value="7"{{#js_if "this.province == 7"}} selected{{/js_if}}>GORONTALO</option>
                          <option value="8"{{#js_if "this.province == 8"}} selected{{/js_if}}>JAMBI</option>
                          <option value="9"{{#js_if "this.province == 9"}} selected{{/js_if}}>JAWA BARAT</option>
                          <option value="10"{{#js_if "this.province == 10"}} selected{{/js_if}}>JAWA TENGAH</option>
                          <option value="11"{{#js_if "this.province == 11"}} selected{{/js_if}}>JAWA TIMUR</option>
                          <option value="12"{{#js_if "this.province == 12"}} selected{{/js_if}}>KALIMANTAN BARAT</option>
                          <option value="13"{{#js_if "this.province == 13"}} selected{{/js_if}}>KALIMANTAN SELATAN</option>
                          <option value="14"{{#js_if "this.province == 14"}} selected{{/js_if}}>KALIMANTAN TENGAH</option>
                          <option value="15"{{#js_if "this.province == 15"}} selected{{/js_if}}>KALIMANTAN TIMUR</option>
                          <option value="16"{{#js_if "this.province == 16"}} selected{{/js_if}}>KALIMANTAN UTARA</option>
                          <option value="17"{{#js_if "this.province == 17"}} selected{{/js_if}}>KEPULAUAN RIAU</option>
                          <option value="18"{{#js_if "this.province == 18"}} selected{{/js_if}}>LAMPUNG</option>
                          <option value="19"{{#js_if "this.province == 19"}} selected{{/js_if}}>MALUKU</option>
                          <option value="20"{{#js_if "this.province == 20"}} selected{{/js_if}}>MALUKU UTARA</option>
                          <option value="21"{{#js_if "this.province == 21"}} selected{{/js_if}}>NANGGROE ACEH DARUSSALAM (NAD)</option>
                          <option value="22"{{#js_if "this.province == 22"}} selected{{/js_if}}>NUSA TENGGARA BARAT (NTB)</option>
                          <option value="23"{{#js_if "this.province == 23"}} selected{{/js_if}}>NUSA TENGGARA TIMUR (NTT)</option>
                          <option value="24"{{#js_if "this.province == 24"}} selected{{/js_if}}>PAPUA</option>
                          <option value="25"{{#js_if "this.province == 25"}} selected{{/js_if}}>PAPUA BARAT</option>
                          <option value="26"{{#js_if "this.province == 26"}} selected{{/js_if}}>RIAU</option>
                          <option value="27"{{#js_if "this.province == 27"}} selected{{/js_if}}>SULAWESI BARAT</option>
                          <option value="28"{{#js_if "this.province == 28"}} selected{{/js_if}}>SULAWESI SELATAN</option>
                          <option value="29"{{#js_if "this.province == 29"}} selected{{/js_if}}>SULAWESI TENGAH</option>
                          <option value="30"{{#js_if "this.province == 30"}} selected{{/js_if}}>SULAWESI TENGGARA</option>
                          <option value="31"{{#js_if "this.province == 31"}} selected{{/js_if}}>SULAWESI UTARA</option>
                          <option value="32"{{#js_if "this.province == 32"}} selected{{/js_if}}>SUMATERA BARAT</option>
                          <option value="33"{{#js_if "this.province == 33"}} selected{{/js_if}}>SUMATERA SELATAN</option>
                          <option value="34"{{#js_if "this.province == 34"}} selected{{/js_if}}>SUMATERA UTARA</option>
                        </select>
                      </div>
                    </div>
                  </li>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Kabupaten/Kota</div>
                      <div class="item-input-wrap">
                        <select id="regency" name="regency">
                          <option value=""{{#unless regency}} selected{{/unless}}>-</option>
                          {{#each regencies}}
                          <option value="{{this.id}}"{{#js_if "../regency == this.id"}} selected{{/js_if}}>{{this.name}}</option>
                          {{/each}}
                        </select>
                      </div>
                    </div>
                  </li>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Kecamatan</div>
                      <div class="item-input-wrap">
                        <select id="district" name="district">
                          <option value=""{{#unless district}} selected{{/unless}}>-</option>
                          {{#each districts}}
                          <option value="{{this.subdistrict_id}}"{{#js_if "../district == this.subdistrict_id"}} selected{{/js_if}}>{{this.subdistrict_name}}</option>
                          {{/each}}
                        </select>
                      </div>
                    </div>
                  </li>
                  <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Kode Pos</div>
                      <div class="item-input-wrap">
                        <input type="text" id="post_code" name="postal_code" value="{{postal_code}}" placeholder="Kode Pos" autocomplete="off" onkeypress="return isNumber(event)"/>
                      </div>
                    </div>
                  </li>
                                
                  <script type="text/javascript">
                      
                    function isNumber(evt) {
                      evt = (evt) ? evt : window.event;
                      var charCode = (evt.which) ? evt.which : evt.keyCode;
                      if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                        return false;
                      }
                      return true;
                    }
                  </script>
                  <!-- <li class="item-content item-input">
                    <div class="item-inner">
                      <div class="item-title item-label">Catatan</div>
                      <div class="item-input-wrap">
                        <input type="text" id="note" name="note" placeholder="Catatan" autocomplete="off"/>
                      </div>
                    </div>
                  </li> -->
                </ul>
              </div>

              <div class="content-block"><a href="#" @click="simpanAlamat" class="button button-raised button-fill larger">Simpan Alamat</a></div>

            </form></div>
        </div>
    </div>
</template>
<script>
  return {
    // Component Methods
    methods: {
      
      simpanAlamat: function (e) {
            
        var name = $$('#name').val();
        if ( name == '')
        {
            app.dialog.alert('Masukkan nama penerima.');
            $$( "#name" ).focus();
            return false;
        }
        
        var address = $$('#address').val();
        if ( address == '')
        {
            app.dialog.alert('Masukkan alamat.');
            $$( "#address" ).focus();
            return false;
        }
        
        // var phone = $$('#phone').val();
        // if ( phone == '')
        // {
        //     app.dialog.alert('Masukkan nomor handphone.');
        //     $$( "#phone" ).focus();
        //     return false;
        // }

        // var email = $$('#email').val();
        // if ( email == '')
        // {
        //     app.dialog.alert('Masukkan email.');
        //     $$( "#email" ).focus();
        //     return false;
        // }

        var province = $$('#province').val();
        if ( province == '')
        {
            app.dialog.alert('Pilih data provinsi.');
            $$( "#province" ).focus();
            return false;
        }
        
        var regency = $$('#regency').val();
        if ( regency == '')
        {
            app.dialog.alert('Pilih data kabupaten.');
            $$( "#regency" ).focus();
            return false;
        }
        
        var district = $$('#district').val();
        if ( district == '')
        {
            app.dialog.alert('Pilih data kecamatan.');
            $$( "#district" ).focus();
            return false;
        }
        
        var post_code = $$('#post_code').val();

        var formData = app.form.convertToData('.address');

        app.request.post( app.data.endpoint + 'api/v1/checkout/address', formData, function(data) {
          // mainView.router.back();
          app.data.bSetAddress = true;
          app.router.navigate('/checkout/', {
            reloadCurrent: true,
            ignoreCache: true,
          });
        });
      }
    },
    // Page Events
    on: {

      pageInit: function(e, page) {
       
        $$('#province').on('change', function(e){
          
          var provid = $$(this).val();

          app.request.json( app.data.endpoint + 'api/v1/checkout/regencies/'+provid, function(json) {
            
            var data = json.data, firstid = data[0].id;
            // console.log('firstid: '+firstid)

            $$('#regency').html('');
            for (var i = 0; i < data.length; i++) {
              $$('#regency').append('<option value="'+data[i].id+'">'+data[i].name+'</option>')
            }
            
            app.request.json( app.data.endpoint + 'api/v1/checkout/districts/'+firstid, function(json) {
              var data = json.data;

              $$('#district').html('');
              for (var i = 0; i < data.length; i++) {
                  $$('#district').append('<option value="'+data[i].subdistrict_id+'">'+data[i].subdistrict_name+'</option>')
              }
            });

            app.request.json( app.data.endpoint + 'api/v1/checkout/post_code/'+firstid, function(json) {
              var data = json.data;
              $$('#post_code').val(data.postal_code);
            });
          });
        });

        
        $$('#regency').on('change', function(e){
          
          var provid = $$('#province').val();
          
          // get district data
          app.request.json( app.data.endpoint + 'api/v1/checkout/districts/'+$$(this).val(), function(json) {
            
            var data = json.data;

            $$('#district').html('');
            for (var i = 0; i < data.length; i++) {
              $$('#district').append('<option value="'+data[i].subdistrict_id+'">'+data[i].subdistrict_name+'</option>')
            }
          });

          // get post code
          app.request.json( app.data.endpoint + 'api/v1/checkout/post_code/'+$$(this).val(), function(json) {
            var data = json.data;
            $$('#post_code').val(data.postal_code);
          });
        });
      }
    }
  }
</script>
