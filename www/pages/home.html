<template>
  <!-- Page, data-name contains page name which can be used in callbacks -->
    <div class="page" data-name="home">
        
        <!-- Top Navbar -->
        <div class="navbar no-shadow">
          <div class="navbar-inner">
            <!-- <div class="left">
              <a href="#" class="link icon-only panel-open" data-panel="left">
                <i class="icon f7-icons ios-only">menu</i>
                <i class="icon material-icons md-only">menu</i>
              </a>
            </div> -->
            <div class="title sliding"><a href="/akun/"><img class="responsive" src="img/logo.png" /></a></div>
            <div class="right">
              <!-- <a href="/chat/" data-view=".view-main" class="link icon-only">
                <i class="icon f7-icons ios-only">chat</i>
                <i class="icon material-icons md-only">chat</i>
              </a> -->
              <a href="/notifikasi/" class="link icon-only">
                <i class="icon f7-icons ios-only">chat<span class="badge notif color-red"></span></i>
                <i class="icon material-icons md-only">chat<span class="badge notif color-red"></span></i>
              </a>
              <a href="/cart/" data-view=".view-main" class="link icon-only">
                <i class="icon f7-icons ios-only">shopping_cart<span class="badge cart color-red"></span></i>
                <i class="icon material-icons md-only">shopping_cart<span class="badge cart color-red"></span></i>
              </a>
              <a href="#" class="link icon-only popover-open" data-popover=".popover-more">
                <i class="icon f7-icons ios-only">more_vert</i>
                <i class="icon material-icons md-only">more_vert</i>
              </a>
            </div>
            <div class="subnavbar no-shadow">
              <div class="title" style="width: 100%; font-size: 16px;">
                <a href="/search/">
                  <div class="search">
                    <span class="searchButton">
                      <i class="icon search f7-icons ios-only">search</i>
                      <i class="icon search material-icons md-only">search</i>
                    </span>
                    <div class="searchTerm">Cari..</div>
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
        <!-- Toolbar-->
        <!-- <div class="toolbar toolbar-bottom-md no-shadow">
            <a href="/akun/" class="link">
              <i class="icon f7-icons ios-only">account_balance_wallet</i>&nbsp;&nbsp;<span class="saldo"></span>
              <i class="icon material-icons md-only">account_balance_wallet</i>&nbsp;&nbsp;<span class="saldo"></span>
            </a>
            <a href="#" class="link popup-open" data-popup="#transfer-bonus">
              <i class="icon f7-icons ios-only">redeem</i>&nbsp;&nbsp;<span class="bonus"></span>
              <i class="icon material-icons md-only">redeem</i>&nbsp;&nbsp;<span class="bonus"></span>
            </a>
          </div>
        </div> -->
                
        <!-- Scrollable page content-->
        <!-- demo-swiper -->
        <div class="page-content">
          <div class="block header">
            <div data-pagination='{"el": ".swiper-pagination"}' class="swiper-container swiper-init dashboard">
              <div class="swiper-pagination dashboard"></div>
              <div class="swiper-wrapper">
                {{#each banner}}
                <div class="swiper-slide"><img class="lazy header" src="{{../$root.endpoint}}upload/mobile-banner/{{img}}" /></div>
                {{/each}}
              </div>
            </div>
          </div>
          
          <!-- <div class="row no-gutter">
            {{#each data}}
            <div class="col-50 tablet-33 category">
              <div class="card">
                <div class="card-content">
                  <a href="/category/{{kdgol}}/{{nama}}" class="item-link">
                    <img class="responsive-card" src="{{../$root.endpoint}}upload/products/{{img}}" />
                    <div class="card-content-inner">{{nama}}</div>
                  </a>
                </div>
              </div>
            </div>
            {{/each}}
          </div> -->

          <div class="row no-gutter">
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/opsi-belanja/" class="btn item-link">
                    <img class="responsive-card" src="img/belanja.png" />
                    <div class="card-content-inner">Belanja</div>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/transfer-saldo/" class="btn item-link">
                    <img class="responsive-card" src="img/transfer.png" />
                    <div class="card-content-inner">Transfer</div>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/opsi-topup/" class="btn item-link">
                    <img class="responsive-card" src="img/topup.png" />
                    <div class="card-content-inner">Topup</div>
                  </a>
                </div>
              </div>
            </div>
          </div>
  
          <div class="row no-gutter">
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/pulsa/" class="btn item-link">
                    <img class="responsive-card" src="img/pulsa.png" />
                    <div class="card-content-inner">Pulsa</div>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/data/" class="btn item-link">
                    <img class="responsive-card" src="img/data.png" />
                    <div class="card-content-inner">Paket Data</div>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/token/" class="btn item-link">
                    <img class="responsive-card" src="img/pln.png" />
                    <div class="card-content-inner">Token PLN</div>
                  </a>
                </div>
              </div>
            </div>
          </div>                 

        <!-- <div class="row no-gutter">
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/gopay/" class="btn item-link">
                    <img class="responsive-card" src="img/gopay.png" />
                    <div class="card-content-inner">GOPAY</div>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/ovo/" class="btn item-link">
                    <img class="responsive-card" src="img/ovo.png" />
                    <div class="card-content-inner">OVO</div>
                  </a>
                </div>
              </div>
            </div>
            <div class="col-33  tablet-33">
              <div class="item-card">
                <div class="card-content">
                  <a href="/dana/" class="btn item-link">
                    <img class="responsive-card" src="img/dana.png" />
                    <div class="card-content-inner">DANA</div>
                  </a>
                </div>
              </div>
            </div>
        </div> -->

        <div class="row no-gutter">
          <div class="col-33  tablet-33">
            <div class="item-card">
              <div class="card-content">
                <a href="/histori-trx/" class="btn item-link">
                  <img class="responsive-card" src="img/histori.png" />
                  <div class="card-content-inner">Histori</div>
                </a>
              </div>
            </div>
          </div>
          <div class="col-33  tablet-33">
            <div class="item-card">
              <div class="card-content">
                <a href="/cek-harga/" class="btn item-link">
                  <img class="responsive-card" src="img/harga.png" />
                  <div class="card-content-inner">Cek Harga</div>
                </a>
              </div>
            </div>
          </div>
          <div class="col-33  tablet-33">
            <div class="item-card">
              <div class="card-content">
                <a href="/daftar/" class="btn item-link">
                  <img class="responsive-card" src="img/daftar.png" />
                  <div class="card-content-inner">Pendaftaran</div>
                </a>
              </div>
            </div>
          </div>
        </div>

      <!-- </div> -->
    
      <div class="block">
        <div class="block-title detail">Produk Terlaris</div>
        <div data-space-between="10" data-slides-per-view="3" class="swiper-container swiper-init swiper-populer">
          <!-- <div class="swiper-pagination"></div> -->
          <div class="swiper-wrapper">
            
            {{#each populer}}
            <div class="swiper-slide detail" @click="doOpenLink('{{barcode}}')">
              <img class="article-populer" src="{{../$root.endpoint}}upload/products/{{#if photo1}}{{photo1}}{{else}}img/noimage.png{{/if}}" />
              <div class="product-name-rel">{{title}}</div>
              <div class="product-price-rel">Rp{{pricef}}</div>
            </div>
            {{/each}}

          </div>
        </div>
      </div>
    </div>
</template>
<script>
  return {
    // Component Methods
    methods: {
      
      doOpenLink: function (code) {

        app.router.navigate('/detail/'+code, {
          // reloadCurrent: true,
          // ignoreCache: true,
        });
      },

      /*nganu: function (e) {
        
        // @click="nganu"
        var db = app.data.db;
    
        if (db) {
          
          db.transaction(function(tx) {
            
            tx.executeSql('select count(*) as total from notifikasi where read = "N";', [], function(ignored, res) {

              var total = res.rows.item(0).total;
              if (total > 0) {
                $$('.badge.notif').text(total);
                $$('.badge.notif').css("display", "block");
                app.dialog.alert('Total unread notification: ' + total);
              } else {
                $$('.badge.notif').css("display", "none");
              }
            });
          }, function(error) {
            app.dialog.alert('insert error: ' + error.message);
          });
        }
            
        // $$('.badge.notif').text('2');
        // $$('.badge.notif').css("display", "block");
      }*/
    },        
    // Page Events
    on: {
      
      pageBeforeIn: function (event, page) {
        
        var db = app.data.db;
    
        if (db) {
          
          db.transaction(function(tx) {
            
            tx.executeSql('select count(*) as total from notifikasi where read = "N";', [], function(ignored, res) {

              var total = res.rows.item(0).total;
              if (total > 0) {
                $$('.badge.notif').text(total);
                $$('.badge.notif').css("display", "block");
              } else {
                $$('.badge.notif').css("display", "none");
              }
            });
          }, function(error) {
            app.dialog.alert('insert error: ' + error.message);
          });
        }
        
        if (app.data.bLogedIn)
        app.request.getJSON( app.data.endpoint + 'api/v1/cart/total_items', function(res) {
          
          app.data.saldo = parseInt(res.saldo);
          app.data.bonus = parseInt(res.bonus);

          if (res.totqty > 0)
          {
            app.data.total_items = res.totqty;
            $$('.badge.cart').text(res.totqty);
            $$('.badge.cart').css("display", "block");
          } else {
            $$('.badge.cart').css("display", "none");
            app.data.total_items = 0;
          }
        });
      },
      
      // pageBeforeOut: function (event, page) {
      //   var swiper = app.swiper.get('.swiper-container.swiper-init.dashboard');
      //   swiper.autoplay.stop();
      //   console.log(swiper.autoplay);
      //   var swiper = app.swiper.get('.swiper-container.swiper-init.populer');
      //   swiper.autoplay.stop();
      //   console.log('swiper autoplay stoped!')
      // },
      
      pageInit: function(e, page) {
                
        // Note: gunakan selecter secara lengkap untuk menghindari error
        // var cmp = $$('.swiper-container.swiper-init.dashboard');
        // console.log(cmp.swiper)
        var swiper = app.swiper.get('.swiper-container.swiper-init.dashboard');
        // console.log(swiper)

        if (swiper === undefined) {
          
          var swiper = app.swiper.create('.swiper-container.swiper-init.dashboard', {
              speed: 3000,
              loop: true,
              spaceBetween: 0
          });
          swiper.autoplay.start();
        }

        var swiper = app.swiper.get('.swiper-container.swiper-init.swiper-populer');

        if (swiper === undefined) {
          // console.log('swiper-populer undefined!')
          var swiper = app.swiper.create('.swiper-container.swiper-init.swiper-populer', {
              speed: 1000,
              loop: true,
              spaceBetween: 5,
              slidesPerView: 3
              // direction: 'vertical',
              // slidesPerColumn: 3,
          });
          swiper.autoplay.start();
        }
      }
    }
  }
</script>
